{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///D:/admin-dash/emails/new-booking-email.tsx"],"sourcesContent":["import {\r\n    Body,\r\n    Button,\r\n    Container,\r\n    Column,\r\n    Head,\r\n    Heading,\r\n    Hr,\r\n    Html,\r\n    Img,\r\n    Link,\r\n    Preview,\r\n    Row,\r\n    Section,\r\n    Text,\r\n} from \"@react-email/components\";\r\nimport * as React from \"react\";\r\n\r\ninterface BookingEmailProps {\r\n    name: string;\r\n    phone_number: string;\r\n    package_title: string;\r\n    date: string;\r\n    guests: number;\r\n    adults?: number;\r\n    children?: number;\r\n    total_price: number;\r\n    status: string;\r\n    notes?: string;\r\n}\r\n\r\nexport const BookingNotificationEmail = ({\r\n    name = \"Valued Guest\",\r\n    phone_number = \"\",\r\n    package_title = \"Unknown Package\",\r\n    date = new Date().toISOString(),\r\n    guests = 1,\r\n    adults = 1,\r\n    children = 0,\r\n    total_price = 0,\r\n    status = \"Pending\",\r\n    notes,\r\n}: BookingEmailProps) => {\r\n    // Safe Date Formatting\r\n    let formattedDate = date;\r\n    try {\r\n        const d = new Date(date);\r\n        if (!isNaN(d.getTime())) {\r\n            formattedDate = d.toLocaleDateString(\"en-US\", {\r\n                weekday: \"long\",\r\n                year: \"numeric\",\r\n                month: \"long\",\r\n                day: \"numeric\",\r\n            });\r\n        }\r\n    } catch (e) {\r\n        console.error(\"Date format error:\", e);\r\n    }\r\n\r\n    // Safe Price Formatting\r\n    let formattedPrice = `${total_price} MAD`;\r\n    try {\r\n        formattedPrice = new Intl.NumberFormat(\"en-MA\", {\r\n            style: \"currency\",\r\n            currency: \"MAD\",\r\n        }).format(total_price);\r\n    } catch (e) {\r\n        console.error(\"Price format error:\", e);\r\n    }\r\n\r\n    // Format phone for WhatsApp (remove spaces, +, etc)\r\n    const waPhone = phone_number ? phone_number.replace(/[^0-9]/g, \"\") : \"\";\r\n\r\n    // App URL (fallback to localhost if env not set)\r\n    const baseUrl = process.env.NEXT_PUBLIC_APP_URL || \"http://localhost:3000\";\r\n\r\n    return (\r\n        <Html>\r\n            <Head />\r\n            <Preview>New Booking: {name} - {package_title}</Preview>\r\n            <Body style={main}>\r\n                <Container style={container}>\r\n                    {/* Header */}\r\n                    <Section style={header}>\r\n                        <Heading style={brandTitle}>MARRAGAFAY</Heading>\r\n                        <Text style={subTitle}>New Booking Request</Text>\r\n                    </Section>\r\n\r\n                    {/* Main Booking Details */}\r\n                    <Section style={contentSection}>\r\n                        <Row>\r\n                            <Column style={columnStyle}>\r\n                                <Text style={label}>CUSTOMER</Text>\r\n                                <Heading as=\"h4\" style={value}>{name}</Heading>\r\n                                <Text style={infoText}>{phone_number || \"No phone provided\"}</Text>\r\n                            </Column>\r\n                            <Column style={columnStyle}>\r\n                                <Text style={label}>BOOKING</Text>\r\n                                <Heading as=\"h4\" style={value}>{package_title}</Heading>\r\n                                <Text style={infoText}>\r\n                                    {formattedDate} ‚Ä¢ {guests} Guests\r\n                                    {/* Optional chaining for adults/children just in case */}\r\n                                    <br />\r\n                                    <span style={subInfo}>({adults ?? 1} Adults, {children ?? 0} Kids)</span>\r\n                                </Text>\r\n                            </Column>\r\n                        </Row>\r\n\r\n                        <Hr style={divider} />\r\n\r\n                        <Row style={{ marginTop: \"20px\" }}>\r\n                            <Column>\r\n                                <Text style={label}>TOTAL PRICE</Text>\r\n                                <Heading as=\"h3\" style={priceValue}>{formattedPrice}</Heading>\r\n                            </Column>\r\n                            <Column>\r\n                                <Text style={label}>STATUS</Text>\r\n                                <Text style={statusBadge}>{status?.toUpperCase() || \"PENDING\"}</Text>\r\n                            </Column>\r\n                        </Row>\r\n\r\n                        {notes && (\r\n                            <Section style={{ marginTop: \"20px\", padding: \"15px\", backgroundColor: \"#fdf8f4\", borderRadius: \"8px\" }}>\r\n                                <Text style={{ ...label, marginBottom: \"5px\" }}>SPECIAL NOTES</Text>\r\n                                <Text style={noteText}>{notes}</Text>\r\n                            </Section>\r\n                        )}\r\n                    </Section>\r\n\r\n                    {/* Action Buttons */}\r\n                    <Section style={actionSection}>\r\n                        <Row>\r\n                            <Column align=\"center\" style={{ paddingRight: \"10px\" }}>\r\n                                <Button\r\n                                    style={primaryButton}\r\n                                    href={`tel:${phone_number}`}\r\n                                >\r\n                                    üìû Call Customer\r\n                                </Button>\r\n                            </Column>\r\n                            <Column align=\"center\" style={{ paddingLeft: \"10px\" }}>\r\n                                <Button\r\n                                    style={secondaryButton}\r\n                                    href={`https://wa.me/${waPhone}`}\r\n                                >\r\n                                    üí¨ WhatsApp\r\n                                </Button>\r\n                            </Column>\r\n                        </Row>\r\n                        <Row style={{ marginTop: \"15px\" }}>\r\n                            <Column align=\"center\">\r\n                                <Link href={`${baseUrl}/dashboard/bookings`} style={dashboardLink}>\r\n                                    View in Dashboard ‚Üí\r\n                                </Link>\r\n                            </Column>\r\n                        </Row>\r\n                    </Section>\r\n\r\n                    {/* Footer */}\r\n                    <Section style={footer}>\r\n                        <Text style={footerText}>\r\n                            Marragafay Travels<br />\r\n                            Marrakech, Morocco<br />\r\n                            <Link href=\"https://marragafay.com\" style={footerLink}>www.marragafay.com</Link>\r\n                        </Text>\r\n                        <Text style={footerSubText}>\r\n                            ¬© {new Date().getFullYear()} Marragafay. All rights reserved.\r\n                        </Text>\r\n                    </Section>\r\n                </Container>\r\n            </Body>\r\n        </Html>\r\n    );\r\n};\r\n\r\nexport default BookingNotificationEmail;\r\n\r\n// --- Styles ---\r\n\r\nconst main = {\r\n    backgroundColor: \"#f5f5f5\",\r\n    fontFamily: '-apple-system,BlinkMacSystemFont,\"Segoe UI\",Roboto,\"Helvetica Neue\",Ubuntu,sans-serif',\r\n};\r\n\r\nconst container = {\r\n    backgroundColor: \"#ffffff\",\r\n    margin: \"0 auto\",\r\n    padding: \"40px 20px\",\r\n    marginBottom: \"64px\",\r\n    maxWidth: \"600px\",\r\n    borderRadius: \"12px\",\r\n    boxShadow: \"0 4px 20px rgba(0, 0, 0, 0.05)\",\r\n};\r\n\r\nconst header = {\r\n    textAlign: \"center\" as const,\r\n    marginBottom: \"30px\",\r\n};\r\n\r\nconst brandTitle = {\r\n    fontSize: \"28px\",\r\n    letterSpacing: \"2px\",\r\n    fontWeight: \"bold\",\r\n    color: \"#C19B76\",\r\n    margin: \"0\",\r\n};\r\n\r\nconst subTitle = {\r\n    fontSize: \"14px\",\r\n    fontWeight: \"500\",\r\n    color: \"#888888\",\r\n    textTransform: \"uppercase\" as const,\r\n    letterSpacing: \"1px\",\r\n    margin: \"5px 0 0\",\r\n};\r\n\r\nconst contentSection = {\r\n    padding: \"0 10px\",\r\n};\r\n\r\nconst columnStyle = {\r\n    verticalAlign: \"top\",\r\n    width: \"50%\",\r\n};\r\n\r\nconst label = {\r\n    fontSize: \"11px\",\r\n    fontWeight: \"bold\",\r\n    color: \"#b0b0b0\",\r\n    textTransform: \"uppercase\" as const,\r\n    letterSpacing: \"1px\",\r\n    marginBottom: \"8px\",\r\n};\r\n\r\nconst value = {\r\n    fontSize: \"16px\",\r\n    fontWeight: \"600\",\r\n    color: \"#333333\",\r\n    margin: \"0 0 5px\",\r\n};\r\n\r\nconst infoText = {\r\n    fontSize: \"14px\",\r\n    color: \"#555555\",\r\n    margin: \"0\",\r\n    lineHeight: \"1.5\",\r\n};\r\n\r\nconst subInfo = {\r\n    fontSize: \"12px\",\r\n    color: \"#888888\",\r\n};\r\n\r\nconst divider = {\r\n    borderColor: \"#f0f0f0\",\r\n    margin: \"25px 0\",\r\n};\r\n\r\nconst priceValue = {\r\n    fontSize: \"24px\",\r\n    fontWeight: \"bold\",\r\n    color: \"#C19B76\",\r\n    margin: \"0\",\r\n};\r\n\r\nconst statusBadge = {\r\n    backgroundColor: \"#f0fdf4\",\r\n    color: \"#166534\",\r\n    padding: \"4px 12px\",\r\n    borderRadius: \"20px\",\r\n    fontSize: \"12px\",\r\n    fontWeight: \"600\",\r\n    display: \"inline-block\",\r\n};\r\n\r\nconst noteText = {\r\n    fontSize: \"14px\",\r\n    color: \"#666666\",\r\n    fontStyle: \"italic\",\r\n    margin: \"0\",\r\n};\r\n\r\nconst actionSection = {\r\n    marginTop: \"40px\",\r\n    textAlign: \"center\" as const,\r\n};\r\n\r\nconst primaryButton = {\r\n    backgroundColor: \"#C19B76\",\r\n    borderRadius: \"8px\",\r\n    color: \"#fff\",\r\n    fontSize: \"14px\",\r\n    fontWeight: \"bold\",\r\n    textDecoration: \"none\",\r\n    textAlign: \"center\" as const,\r\n    display: \"block\",\r\n    padding: \"12px 20px\",\r\n    width: \"100%\",\r\n};\r\n\r\nconst secondaryButton = {\r\n    backgroundColor: \"#25D366\", // WhatsApp Green\r\n    borderRadius: \"8px\",\r\n    color: \"#fff\",\r\n    fontSize: \"14px\",\r\n    fontWeight: \"bold\",\r\n    textDecoration: \"none\",\r\n    textAlign: \"center\" as const,\r\n    display: \"block\",\r\n    padding: \"12px 20px\",\r\n    width: \"100%\",\r\n};\r\n\r\nconst dashboardLink = {\r\n    fontSize: \"14px\",\r\n    color: \"#C19B76\",\r\n    textDecoration: \"none\",\r\n    fontWeight: \"500\",\r\n    display: \"inline-block\",\r\n};\r\n\r\nconst footer = {\r\n    marginTop: \"40px\",\r\n    textAlign: \"center\" as const,\r\n    borderTop: \"1px solid #f0f0f0\",\r\n    paddingTop: \"30px\",\r\n};\r\n\r\nconst footerText = {\r\n    fontSize: \"12px\",\r\n    color: \"#999999\",\r\n    lineHeight: \"1.6\",\r\n    margin: \"0 0 10px\",\r\n};\r\n\r\nconst footerLink = {\r\n    color: \"#999999\",\r\n    textDecoration: \"underline\",\r\n};\r\n\r\nconst footerSubText = {\r\n    fontSize: \"10px\",\r\n    color: \"#cccccc\",\r\n    margin: \"0\",\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 627, "column": 0}, "map": {"version":3,"sources":["file:///D:/admin-dash/app/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { Resend } from 'resend'\r\nimport { renderAsync } from '@react-email/render' // CRITICAL: Use renderAsync for Next.js 16 App Router\r\nimport { BookingNotificationEmail } from '@/emails/new-booking-email'\r\n\r\nconst resend = new Resend(process.env.RESEND_API_KEY)\r\n\r\ninterface BookingEmailData {\r\n  name: string\r\n  phone_number: string\r\n  package_title: string\r\n  date: string\r\n  guests: number\r\n  adults: number\r\n  children: number\r\n  total_price: number\r\n  status: string\r\n  notes?: string\r\n}\r\n\r\nexport async function sendBookingEmail(booking: BookingEmailData) {\r\n  console.log(\"üî¥ STEP 1: SERVER ACTION STARTED - sendBookingEmail\")\r\n  console.log(\"üî¥ STEP 2: Booking data received:\", JSON.stringify(booking, null, 2))\r\n\r\n  try {\r\n    // CRITICAL CONNECTIVITY TEST (Hardcoded as requested)\r\n    console.log(\"üî¥ STEP 3: Attempting HARDCODED connectivity test...\")\r\n    try {\r\n      const testResult = await resend.emails.send({\r\n        from: 'onboarding@resend.dev',\r\n        to: 'imadaitlachger@gmail.com',\r\n        subject: 'API TEST',\r\n        html: '<p>Test</p>'\r\n      })\r\n      console.log(\"‚úÖ STEP 3 SUCCESS: Connectivity test passed:\", testResult)\r\n    } catch (testError) {\r\n      console.error(\"‚ùå STEP 3 FAILED: Connectivity test failed:\", testError)\r\n      throw new Error(\"Resend API connectivity test failed\")\r\n    }\r\n\r\n    // Check API Key\r\n    console.log(\"üî¥ STEP 4: Checking RESEND_API_KEY:\", process.env.RESEND_API_KEY ? \"EXISTS\" : \"‚ùå MISSING\")\r\n    if (!process.env.RESEND_API_KEY) {\r\n      throw new Error(\"RESEND_API_KEY is not defined in environment variables\")\r\n    }\r\n\r\n    // Sanitize booking data (convert all to strings/numbers as requested)\r\n    console.log(\"üî¥ STEP 5: Sanitizing payload...\")\r\n    const sanitizedBooking = {\r\n      name: String(booking.name || 'Unknown'),\r\n      phone_number: String(booking.phone_number || 'N/A'),\r\n      package_title: String(booking.package_title || 'Unknown Package'),\r\n      date: String(booking.date || new Date().toISOString()),\r\n      guests: Number(booking.guests) || 1,\r\n      adults: Number(booking.adults) || 1,\r\n      children: Number(booking.children) || 0,\r\n      total_price: Number(booking.total_price) || 0,\r\n      status: String(booking.status || 'Pending'),\r\n      notes: booking.notes ? String(booking.notes) : undefined\r\n    }\r\n    console.log(\"‚úÖ STEP 5 SUCCESS: Payload sanitized:\", sanitizedBooking)\r\n\r\n    // Render Template with ASYNC method (CRITICAL FIX)\r\n    console.log(\"üî¥ STEP 6: Calling renderAsync() for email template...\")\r\n    let htmlContent = \"\"\r\n    try {\r\n      htmlContent = await renderAsync(\r\n        BookingNotificationEmail({\r\n          name: sanitizedBooking.name,\r\n          phone_number: sanitizedBooking.phone_number,\r\n          package_title: sanitizedBooking.package_title,\r\n          date: sanitizedBooking.date,\r\n          guests: sanitizedBooking.guests,\r\n          adults: sanitizedBooking.adults,\r\n          children: sanitizedBooking.children,\r\n          total_price: sanitizedBooking.total_price,\r\n          status: sanitizedBooking.status,\r\n          notes: sanitizedBooking.notes\r\n        })\r\n      )\r\n      console.log(\"‚úÖ STEP 6 SUCCESS: Template rendered. HTML Length:\", htmlContent.length)\r\n    } catch (renderError) {\r\n      console.error(\"‚ùå STEP 6 FAILED: renderAsync crashed:\", renderError)\r\n      throw renderError\r\n    }\r\n\r\n    // Send Email to ADMIN (explicitly hardcoded as requested)\r\n    console.log(\"üî¥ STEP 7: Sending email to ADMIN (imadaitlachger@gmail.com)...\")\r\n    const { data, error } = await resend.emails.send({\r\n      from: 'Marragafay Bookings <onboarding@resend.dev>',\r\n      to: ['imadaitlachger@gmail.com'], // EXPLICIT admin email as requested\r\n      subject: `New Booking: ${sanitizedBooking.name} - ${sanitizedBooking.package_title}`,\r\n      html: htmlContent\r\n    })\r\n\r\n    if (error) {\r\n      console.error(\"‚ùå STEP 7 FAILED: Resend API returned error:\", error)\r\n      throw error\r\n    }\r\n\r\n    console.log(\"‚úÖ STEP 7 SUCCESS: Email sent successfully. Resend ID:\", data?.id)\r\n    console.log(\"‚úÖ ALL STEPS COMPLETE - Email system working\")\r\n    return { success: true, data }\r\n\r\n  } catch (err) {\r\n    console.error(\"üí• CRITICAL FAILURE - Email process crashed:\", err)\r\n    console.error(\"Error details:\", {\r\n      message: err instanceof Error ? err.message : 'Unknown error',\r\n      stack: err instanceof Error ? err.stack : undefined\r\n    })\r\n\r\n    // ABSOLUTE FALLBACK (Simple email without template)\r\n    console.log(\"üî¥ FALLBACK: Attempting to send simple HTML email...\")\r\n    try {\r\n      const { data } = await resend.emails.send({\r\n        from: 'Marragafay Bookings <onboarding@resend.dev>',\r\n        to: ['imadaitlachger@gmail.com'],\r\n        subject: `New Booking (FALLBACK): ${booking.name}`,\r\n        html: `\r\n          <h2>‚ö†Ô∏è Email System Fallback</h2>\r\n          <p>The fancy template failed. Here's the raw booking data:</p>\r\n          <pre>${JSON.stringify(booking, null, 2)}</pre>\r\n          <p style=\"color: red;\">Error: ${err instanceof Error ? err.message : 'Unknown error'}</p>\r\n        `\r\n      })\r\n      console.log(\"‚úÖ FALLBACK SUCCESS: Simple email sent. ID:\", data?.id)\r\n      return { success: true, data, note: \"Fallback email sent\" }\r\n    } catch (fallbackErr) {\r\n      console.error(\"üí• FALLBACK ALSO FAILED:\", fallbackErr)\r\n      return { success: false, error: fallbackErr }\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 773, "column": 0}, "map": {"version":3,"sources":["file:///D:/admin-dash/.next-internal/server/app/dashboard/bookings/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendBookingEmail as '4081f1dd4aa8ea82e26767a0ae58c488b12e552900'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}