{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///D:/admin-dash/app/actions.ts"],"sourcesContent":["'use server'\r\n\r\nimport { Resend } from 'resend'\r\n\r\nconst resend = new Resend(process.env.RESEND_API_KEY)\r\n\r\ninterface BookingEmailData {\r\n  name: string\r\n  phone_number: string\r\n  package_title: string\r\n  date: string\r\n  guests: number\r\n  total_price: number\r\n  status?: string\r\n  notes?: string\r\n}\r\n\r\nexport async function sendBookingEmail(booking: BookingEmailData) {\r\n  console.log(\"=== EMAIL ACTION STARTED ===\")\r\n  console.log(\"Received booking:\", JSON.stringify(booking, null, 2))\r\n\r\n  try {\r\n    // Sanitize all data to strings/numbers\r\n    const name = String(booking.name || 'Unknown')\r\n    const phone = String(booking.phone_number || 'N/A')\r\n    const phoneClean = phone.replace(/[^0-9]/g, '')\r\n    const packageTitle = String(booking.package_title || 'Unknown Package')\r\n    const date = String(booking.date || new Date().toISOString().split('T')[0])\r\n    const guests = Number(booking.guests) || 1\r\n    const price = Number(booking.total_price) || 0\r\n    const notes = booking.notes ? String(booking.notes) : ''\r\n\r\n    console.log(\"Data sanitized successfully\")\r\n\r\n    // Format date nicely\r\n    let formattedDate = date\r\n    try {\r\n      const d = new Date(date)\r\n      formattedDate = d.toLocaleDateString('en-US', {\r\n        weekday: 'long',\r\n        month: 'long',\r\n        day: 'numeric',\r\n        year: 'numeric'\r\n      })\r\n    } catch (e) {\r\n      console.log(\"Date formatting failed, using raw date\")\r\n    }\r\n\r\n    // Format price\r\n    const formattedPrice = price.toLocaleString() + ' MAD'\r\n\r\n    // Create simple HTML email using template literal\r\n    const htmlContent = `\r\n<!DOCTYPE html>\r\n<html>\r\n<head>\r\n  <meta charset=\"utf-8\">\r\n  <title>New Booking</title>\r\n</head>\r\n<body style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; padding: 20px;\">\r\n  \r\n  <h2 style=\"color: #C19B76; text-align: center; border-bottom: 3px solid #C19B76; padding-bottom: 10px;\">\r\n    Marragafay - New Booking\r\n  </h2>\r\n\r\n  <table style=\"width: 100%; border-collapse: collapse; margin: 20px 0;\">\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold; width: 150px;\">Customer Name:</td>\r\n      <td style=\"padding: 10px; background: #fff;\">${name}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold;\">Phone:</td>\r\n      <td style=\"padding: 10px; background: #fff;\">${phone}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold;\">Package:</td>\r\n      <td style=\"padding: 10px; background: #fff;\">${packageTitle}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold;\">Date:</td>\r\n      <td style=\"padding: 10px; background: #fff;\">${formattedDate}</td>\r\n    </tr>\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold;\">Guests:</td>\r\n      <td style=\"padding: 10px; background: #fff;\">${guests} ${guests === 1 ? 'person' : 'people'}</td>\r\n    </tr>\r\n    <tr style=\"background: #fff4e6;\">\r\n      <td style=\"padding: 10px; font-weight: bold; font-size: 18px;\">Total Price:</td>\r\n      <td style=\"padding: 10px; font-weight: bold; font-size: 20px; color: #C19B76;\">${formattedPrice}</td>\r\n    </tr>\r\n    ${notes ? `\r\n    <tr>\r\n      <td style=\"padding: 10px; background: #f9f9f9; font-weight: bold;\">Notes:</td>\r\n      <td style=\"padding: 10px; background: #fff; font-style: italic;\">${notes}</td>\r\n    </tr>\r\n    ` : ''}\r\n  </table>\r\n\r\n  <div style=\"margin: 30px 0; text-align: center;\">\r\n    <a href=\"tel:${phone}\" style=\"display: inline-block; background-color: #C19B76; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 5px; font-weight: bold;\">\r\n      ðŸ“ž Call Customer\r\n    </a>\r\n    <a href=\"https://wa.me/${phoneClean}\" style=\"display: inline-block; background-color: #25D366; color: white; padding: 12px 30px; text-decoration: none; border-radius: 5px; margin: 5px; font-weight: bold;\">\r\n      ðŸ’¬ WhatsApp\r\n    </a>\r\n  </div>\r\n\r\n  <p style=\"text-align: center; color: #999; font-size: 12px; margin-top: 40px; border-top: 1px solid #ddd; padding-top: 20px;\">\r\n    Marragafay Travels | Marrakech, Morocco<br>\r\n    <a href=\"https://marragafay.com\" style=\"color: #C19B76;\">www.marragafay.com</a>\r\n  </p>\r\n\r\n</body>\r\n</html>\r\n    `\r\n\r\n    console.log(\"HTML content created, length:\", htmlContent.length)\r\n    console.log(\"SENDING: Attempting to send email...\")\r\n    console.log(\"To: Marragafay@gmail.com\")\r\n    console.log(\"CC: imadaitlachger@gmail.com\")\r\n\r\n    // Send email with both recipients\r\n    const { data, error } = await resend.emails.send({\r\n      from: 'Marragafay Bookings <onboarding@resend.dev>',\r\n      to: ['Marragafay@gmail.com'],\r\n      cc: ['imadaitlachger@gmail.com'],\r\n      subject: `New Booking: ${name} - ${packageTitle}`,\r\n      html: htmlContent\r\n    })\r\n\r\n    if (error) {\r\n      console.error(\"FAILED: Resend returned error:\", error)\r\n      throw error\r\n    }\r\n\r\n    console.log(\"SUCCESS: Email sent to Resend API\")\r\n    console.log(\"Email ID:\", data?.id)\r\n    console.log(\"=== EMAIL ACTION COMPLETED ===\")\r\n\r\n    return { success: true, emailId: data?.id }\r\n\r\n  } catch (error) {\r\n    console.error(\"CRITICAL ERROR in sendBookingEmail:\", error)\r\n    console.error(\"Error type:\", typeof error)\r\n    console.error(\"Error details:\", error instanceof Error ? error.message : String(error))\r\n\r\n    return {\r\n      success: false,\r\n      error: error instanceof Error ? error.message : 'Unknown error'\r\n    }\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM,SAAS,IAAI,8PAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAa7C,eAAe,iBAAiB,OAAyB;IAC9D,QAAQ,GAAG,CAAC;IACZ,QAAQ,GAAG,CAAC,qBAAqB,KAAK,SAAS,CAAC,SAAS,MAAM;IAE/D,IAAI;QACF,uCAAuC;QACvC,MAAM,OAAO,OAAO,QAAQ,IAAI,IAAI;QACpC,MAAM,QAAQ,OAAO,QAAQ,YAAY,IAAI;QAC7C,MAAM,aAAa,MAAM,OAAO,CAAC,WAAW;QAC5C,MAAM,eAAe,OAAO,QAAQ,aAAa,IAAI;QACrD,MAAM,OAAO,OAAO,QAAQ,IAAI,IAAI,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;QAC1E,MAAM,SAAS,OAAO,QAAQ,MAAM,KAAK;QACzC,MAAM,QAAQ,OAAO,QAAQ,WAAW,KAAK;QAC7C,MAAM,QAAQ,QAAQ,KAAK,GAAG,OAAO,QAAQ,KAAK,IAAI;QAEtD,QAAQ,GAAG,CAAC;QAEZ,qBAAqB;QACrB,IAAI,gBAAgB;QACpB,IAAI;YACF,MAAM,IAAI,IAAI,KAAK;YACnB,gBAAgB,EAAE,kBAAkB,CAAC,SAAS;gBAC5C,SAAS;gBACT,OAAO;gBACP,KAAK;gBACL,MAAM;YACR;QACF,EAAE,OAAO,GAAG;YACV,QAAQ,GAAG,CAAC;QACd;QAEA,eAAe;QACf,MAAM,iBAAiB,MAAM,cAAc,KAAK;QAEhD,kDAAkD;QAClD,MAAM,cAAc,CAAC;;;;;;;;;;;;;;;;mDAgB0B,EAAE,KAAK;;;;mDAIP,EAAE,MAAM;;;;mDAIR,EAAE,aAAa;;;;mDAIf,EAAE,cAAc;;;;mDAIhB,EAAE,OAAO,CAAC,EAAE,WAAW,IAAI,WAAW,SAAS;;;;qFAIb,EAAE,eAAe;;IAElG,EAAE,QAAQ,CAAC;;;uEAGwD,EAAE,MAAM;;IAE3E,CAAC,GAAG,GAAG;;;;iBAIM,EAAE,MAAM;;;2BAGE,EAAE,WAAW;;;;;;;;;;;;IAYpC,CAAC;QAED,QAAQ,GAAG,CAAC,iCAAiC,YAAY,MAAM;QAC/D,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC;QAEZ,kCAAkC;QAClC,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YAC/C,MAAM;YACN,IAAI;gBAAC;aAAuB;YAC5B,IAAI;gBAAC;aAA2B;YAChC,SAAS,CAAC,aAAa,EAAE,KAAK,GAAG,EAAE,cAAc;YACjD,MAAM;QACR;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,kCAAkC;YAChD,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,aAAa,MAAM;QAC/B,QAAQ,GAAG,CAAC;QAEZ,OAAO;YAAE,SAAS;YAAM,SAAS,MAAM;QAAG;IAE5C,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,uCAAuC;QACrD,QAAQ,KAAK,CAAC,eAAe,OAAO;QACpC,QAAQ,KAAK,CAAC,kBAAkB,iBAAiB,QAAQ,MAAM,OAAO,GAAG,OAAO;QAEhF,OAAO;YACL,SAAS;YACT,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAClD;IACF;AACF;;;IAtIsB;;AAAA,8WAAA"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///D:/admin-dash/.next-internal/server/app/dashboard/bookings/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {sendBookingEmail as '4081f1dd4aa8ea82e26767a0ae58c488b12e552900'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}